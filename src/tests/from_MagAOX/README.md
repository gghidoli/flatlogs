# Catch2 Test Generator for MagAOX Flatlogs

The test generator is composed of two files, `generateTemplatedCatch2Tests.py` and `catch2TestTemplate.jinja2`.

## How To Run

### Pre-requisites
 1. Python must be installed with version >= 3.9
 2. jinja2 must be installed. The python generator script will check for jinja2 and automatically install it if not present.
    Alternatively, it can be installed manually with the following command:

    `python3 -m pip install Jinja2`

Additionally, it is assumed that `mxlib` and its dependencies have already been installed.

### Generating the tests
`generateTemplatedCatch2Tests.py` and `catch2TestTemplate.jinja2` should be in the same directory as `types/`.
The generator can be run by either running the python script directly, or calling to the Makefile target. They are functionally identical.

To run the generator, do:

`python3 ./generateTemplatedCatch2Tests.py`

or 

`make generated_tests`


Upon success, a folder titled `generated_tests` will be created, containing generated tests with the title `<log_type>_generated_tests.cpp`.

### Running the tests
To run the tests, do:

`make do_catch2_test`

If the generated test files are not present, they will be generated by the Makefile.


## Notes:

- At the start of the generator python script, the previous generated test files will be deleted. Because random values are used for test values, this means values will change between runs of the generator.

- This script detects a 'base' type if it does not have eventCode and defaultLevel
  in the .hpp file. It is noted in these log types that they cannot be used directly.
  On the first iteration through the log types, the base types and their inherited
  types are found. Then, the script generates the test files for these inherited 
  types. The base types I found are:
    - empty_log
    - flatbuffer_log
    - software_log
    - string_log
    - saving_state_change (not explicitly noted, but inferred)

  I assume that these base types do not require tests.

- To handle subtle differences in field names in the .fbs and .hpp files, the generator
  reads both .fbs file names and .hpp names and uses the appropriate name when needed.
  The caveat to this is that the order in which those names appear MUST correspond between 
  the two files. The only file this became an issue was `telem_fxngen.hpp`. The field 
  names were different between files, as well as their order. This caused a compiler error
  when calling the constructor. To fix this, I re-ordered the messageT field names in 
  `telem_fxngen.hpp` to match `telem_fxngen.fbs`.

- Added #include "../logMeta.hpp" to (needed for compilation):
    - telem_observer.hpp
    - telem_loopgain.hpp
    - telem_fgtimings.hpp
    - telem_dmspeck.hpp
    - telem_dmmodes.hpp 
